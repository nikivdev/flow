version = 1

[dependencies]
fast = "github.com/1focus-ai/fast"

[flox]
[flox.install]
cargo.pkg-path = "cargo"
eza.pkg-path = "eza"

[[tasks]]
name = "setup"
command = "cargo check"
description = "Compile the workspace to make sure the toolchain works"
activate_on_cd_to_root = true

[[tasks]]
name = "test"
command = "cargo test"
description = "Run the full test suite for a basic sanity check"

[[tasks]]
name = "which-cargo"
command = "which cargo && cargo --version"
description = "Confirm cargo is coming from the managed toolchain"
dependencies = ["cargo"]

[[tasks]]
name = "test-deps"
command = "tsx tests/deps.ts"
description = "Run the e2e managed-deps test script"

[[tasks]]
name = "dev-hub"
command = "cargo run -- hub start"
description = "Ensure the hub daemon is running locally"

[[tasks]]
name = "deploy-cli-local"
command = "./scripts/deploy.sh"
description = "Build the CLI/daemon and copy the binary to ~/.local/bin/flow"

[[tasks]]
name = "deploy-cli-release"
command = "FLOW_PROFILE=release ./scripts/deploy.sh"
description = "Build the CLI/daemon with --release and copy the binary to ~/.local/bin/flow"

[[tasks]]
name = "commit"
command = "fast commitPush"
description = "Commit with AI"
dependencies = ["fast"]        # references [dependencies].fast above
delegate_to_hub = true

[storage]
provider = "1focus.ai"
env_var = "FLOW_SECRETS_TOKEN" # optional; defaults to this value

[[storage.envs]]
name = "local"
description = "Local development defaults"
variables = [
  { key = "DATABASE_URL", default = "" },
  { key = "OPENAI_API_KEY", default = "" },
  { key = "ANTHROPIC_API_KEY", default = "" },
]
